<!DOCTYPE html>
<html lang="ru">
<head>
<link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="manifest" href="site.webmanifest">
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–ù–∞–π–¥–∏ –ø–∞—Ä—ã</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap');
    * { box-sizing: border-box; }
    body {
      margin: 0; padding: 0;
      background: linear-gradient(135deg, #89f7fe 0%, #66a6ff 100%);
      font-family: 'Montserrat', sans-serif;
      display: flex; flex-direction: column; min-height: 100vh;
      align-items: center; user-select: none; overflow-x: hidden;
    }
    h1 {
      margin: 20px 0 10px;
      color: #fff;
      text-shadow: 2px 2px 6px rgba(0,0,0,0.4);
    }
    #difficulty button, .game-btn {
      margin: 5px 10px;
      padding: 10px 20px;
      font-size: 16px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      font-weight: 700;
      color: white;
      background: #007bff;
      box-shadow: 0 4px 10px rgba(0,123,255,0.4);
      transition: all 0.3s ease;
    }
    #difficulty button:hover, .game-btn:hover { background: #0056b3; transform: translateY(-2px); }
    #difficulty button:disabled { background: #5a96d4; cursor: default; transform: none; }

    #game-board {
      display: grid;
      gap: 12px;
      max-width: 95vw;
      justify-content: center;
      margin-top: 15px; 
      margin-bottom: 20px;
      transition: all 0.5s ease-in-out;
    }
    .card { 
      width: 90px; 
      height: 120px; 
      perspective: 1000px; 
      cursor: pointer;
      transition: opacity 0.6s ease, transform 0.5s ease-in-out, grid-area 0.5s ease-in-out;
    }
    .card.disabled {
      cursor: not-allowed;
      pointer-events: none;
    }
    .card-inner {
      position: relative; width: 100%; height: 100%;
      transition: transform 0.5s; transform-style: preserve-3d;
      border-radius: 12px; box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }
    .card.flipped .card-inner { transform: rotateY(180deg); }
    .card-front, .card-back {
      position: absolute; width: 100%; height: 100%;
      border-radius: 12px; backface-visibility: hidden;
      display: flex; justify-content: center; align-items: center; font-size: 48px;
    }
    .card-front { background: #fff; transform: rotateY(180deg); }
    .card-back { background: #1e90ff; color: #fff; box-shadow: inset 0 0 20px #1565c0; }

    #modal, #modal-settings, #modal-stats, #modal-confirm {
      position: fixed; top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0, 0, 0, 0.6);
      display: flex; align-items: center; justify-content: center;
      opacity: 0; pointer-events: none; transition: opacity 0.3s ease; z-index: 2000;
    }
    #modal.active, #modal-settings.active, #modal-stats.active, #modal-confirm.active { opacity: 1; pointer-events: auto; }

    .modal-box {
      background: linear-gradient(135deg, #89f7fe 0%, #66a6ff 100%);
      padding: 20px 40px; max-width: 420px; width: 90%; text-align: center;
      border-radius: 20px; border: 3px solid white; box-shadow: 0 15px 35px rgba(0,0,0,0.4);
    }

    .modal-box h2 { 
      margin-top: 0;
      margin-bottom: 15px; 
      font-weight: 700; 
      font-size: 28px; 
      color: #fff; 
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3); 
    }
    
    .st-row { margin: 10px 0; text-align: left; }
    .st-row label { display: block; margin-bottom: 5px; font-weight: bold; color: #fff; }
    
    .language-container {
      position: relative;
      width: 100%;
    }
    
    .language-select-wrapper {
      position: relative;
      width: 100%;
    }
    
    #lang-select {
      width: 100%; 
      padding: 15px 20px;
      font-size: 18px; 
      border-radius: 12px;
      font-family: 'Montserrat', sans-serif; 
      border: 2px solid white;
      background: rgba(255, 255, 255, 0.95);
      cursor: pointer;
      transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      appearance: none;
      -webkit-appearance: none;
      -moz-appearance: none;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      color: #333;
      font-weight: 600;
    }
    
    #lang-select:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(0, 123, 255, 0.3);
      background: white;
      border-color: #66a6ff;
    }
    
    #lang-select:focus {
      outline: none;
      transform: translateY(-2px) scale(1.02);
      box-shadow: 0 10px 30px rgba(102, 166, 255, 0.4);
      border-color: #007bff;
    }
    
    .full-width { width: 100%; margin: 10px 0 !important; }
    #play-again { background-color: #28a745; }
    #exit-win { background-color: #dc3545; }
    #sound-toggle { background-color: #17a2b8; }

    #settings-btn {
      position: fixed; top: 20px; right: 20px; 
      background: linear-gradient(135deg, #89f7fe 0%, #66a6ff 100%);
      border: 2px solid white;
      border-radius: 50%; 
      width: 50px; 
      height: 50px;
      font-size: 24px; 
      cursor: pointer; 
      display: flex;
      align-items: center; 
      justify-content: center;
      box-shadow: 0 4px 15px rgba(0,123,255,0.3); 
      z-index: 1500;
      color: white;
      transition: all 0.3s ease;
    }

    #stats-btn {
      position: fixed; bottom: 20px; right: 20px; 
      background: linear-gradient(135deg, #ff9a9e 0%, #fad0c4 100%);
      border: 2px solid white;
      border-radius: 50%; 
      width: 50px; 
      height: 50px;
      font-size: 20px; 
      cursor: pointer; 
      display: flex;
      align-items: center; 
      justify-content: center;
      box-shadow: 0 4px 15px rgba(255, 154, 158, 0.3); 
      z-index: 1500;
      color: white;
      transition: all 0.3s ease;
    }

    #settings-btn:hover, #stats-btn:hover {
      transform: scale(1.1);
      box-shadow: 0 6px 20px rgba(0,123,255,0.4);
    }
    
    #message {
      position: fixed; top: 20px; left: 50%; transform: translateX(-50%);
      background: rgba(50, 50, 50, 0.9); color: #fff; padding: 12px 24px;
      border-radius: 12px; font-size: 22px; font-weight: bold;
      opacity: 0; transition: opacity 0.5s ease; z-index: 3000;
      pointer-events: none; border: 2px solid #fff;
    }

    .volume-control {
      margin: 15px 0;
      padding: 15px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      border: 2px solid rgba(255, 255, 255, 0.2);
    }

    .volume-slider-container {
      display: flex;
      align-items: center;
      margin: 12px 0;
    }

    .volume-slider {
      flex: 1;
      -webkit-appearance: none;
      appearance: none;
      height: 10px;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 5px;
      outline: none;
      cursor: pointer;
    }

    .volume-slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 24px;
      height: 24px;
      border-radius: 50%;
      background: linear-gradient(135deg, #89f7fe 0%, #66a6ff 100%);
      cursor: pointer;
      border: 3px solid white;
      box-shadow: 0 0 10px rgba(0, 123, 255, 0.5);
      transition: all 0.3s ease;
    }

    .volume-slider::-webkit-slider-thumb:hover {
      transform: scale(1.1);
      box-shadow: 0 0 15px rgba(0, 123, 255, 0.8);
    }

    .volume-slider::-moz-range-thumb {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      background: linear-gradient(135deg, #89f7fe 0%, #66a6ff 100%);
      cursor: pointer;
      border: 3px solid white;
      box-shadow: 0 0 10px rgba(0, 123, 255, 0.5);
    }

    .volume-value {
      margin-left: 15px;
      min-width: 40px;
      text-align: center;
      font-weight: bold;
      color: white;
      font-size: 16px;
      text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
      background: rgba(255, 255, 255, 0.2);
      padding: 5px 10px;
      border-radius: 8px;
      border: 1px solid rgba(255, 255, 255, 0.3);
    }

    .volume-label {
      display: block;
      margin-bottom: 6px;
      font-weight: bold;
      color: white;
      font-size: 16px;
      text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .modal-box {
      animation: fadeInUp 0.4s ease-out;
    }

    .music-note {
      font-size: 20px;
      margin-right: 8px;
      vertical-align: middle;
    }

    .timer-container {
      position: fixed;
      top: 20px;
      left: 20px;
      background: rgba(0, 0, 0, 0.7);
      color: #fff;
      padding: 12px 20px;
      border-radius: 12px;
      font-size: 22px;
      font-weight: bold;
      font-family: 'Courier New', monospace;
      border: 2px solid #fff;
      display: none;
      z-index: 1000;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
    }

    .timer-display {
      letter-spacing: 2px;
      text-shadow: 0 0 8px rgba(255, 255, 255, 0.5);
    }

    .stats-display {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      padding: 15px;
      margin: 10px 0;
      border: 2px solid rgba(255, 255, 255, 0.2);
      text-align: left;
      font-size: 14px;
      color: white;
    }

    .stats-display h3 {
      margin: 0 0 10px 0;
      color: #e6f7ff;
      text-align: center;
      font-size: 18px;
    }

    .stats-row {
      margin: 8px 0;
      padding: 6px 10px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 8px;
      border-left: 3px solid #89f7fe;
    }

    .stats-label {
  font-weight: bold;
  color: #e6f7ff;
  display: inline-block;
  width: 140px;
}

    .stats-value {
      font-family: 'Courier New', monospace;
      font-weight: bold;
    }

    .stats-time {
      font-family: 'Courier New', monospace;
      font-size: 13px;
      letter-spacing: 1px;
    }
  </style>
</head>
<body>

<h1 id="main-title">Find Pairs</h1>

<div id="difficulty">
  <button data-cards="10" id="btn-easy">Easy</button>
  <button data-cards="20" id="btn-norm">Normal</button>
  <button data-cards="30" id="btn-hard">Hard</button>
  <button data-cards="50" id="btn-extr">Extreme</button>
</div>

<button id="settings-btn" title="Settings">‚öôÔ∏è</button>
<button id="stats-btn" title="Statistics">üìä</button>

<div id="game-board"></div>

<div id="message"></div>

<div id="timer-container" class="timer-container">
  <span id="timer-display" class="timer-display">00:00:00.000</span>
</div>

<div id="modal">
  <div class="modal-box">
    <h2 id="win-text">Well done!</h2>
    <button id="play-again" class="game-btn full-width">Play Again</button>
    <button id="exit-win" class="game-btn full-width">Exit</button>
  </div>
</div>

<div id="modal-settings">
  <div class="modal-box">
    <h2 id="st-header">Settings</h2>
    
    <div class="st-row">
      <label id="st-lang-label">Language:</label>
      <div class="language-container">
        <div class="language-select-wrapper">
          <select id="lang-select">
            <option value="ru" class="language-option">–†—É—Å—Å–∫–∏–π</option>
            <option value="en" selected class="language-option">English</option>
            <option value="ua" class="language-option">–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞</option>
            <option value="by" class="language-option">–ë–µ–ª–∞—Ä—É—Å–∫–∞—è</option>
            <option value="it" class="language-option">Italiano</option>
            <option value="es" class="language-option">Espa√±ol</option>
            <option value="ar" class="language-option">ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</option>
            <option value="zh" class="language-option">‰∏≠Êñá</option>
            <option value="jp" class="language-option">Êó•Êú¨Ë™û</option>
            <option value="de" class="language-option">Deutsch</option>
          </select>
        </div>
      </div>
    </div>
    
    <div class="volume-control">
      <label class="volume-label" id="music-volume-label">Music Volume:</label>
      <div class="volume-slider-container">
        <input type="range" min="0" max="100" value="50" class="volume-slider" id="music-volume">
        <div class="volume-value" id="music-volume-value">50%</div>
      </div>
      
      <label class="volume-label" id="effects-volume-label">Effects Volume:</label>
      <div class="volume-slider-container">
        <input type="range" min="0" max="100" value="70" class="volume-slider" id="effects-volume">
        <div class="volume-value" id="effects-volume-value">70%</div>
      </div>
    </div>
    
    <button id="sound-toggle" class="game-btn full-width">Music: ON</button>
    <button id="timer-toggle" class="game-btn full-width">Timer: OFF</button>
    <button id="close-settings" class="game-btn full-width">OK</button>
  </div>
</div>

<div id="modal-stats">
  <div class="modal-box">
    <h2 id="stats-header">Statistics</h2>
    
    <div class="stats-display">
      <h3 id="stats-title">üìà Game Statistics</h3>
      
      <div class="stats-row">
        <span class="stats-label" id="stats-best-time-label">Best Time:</span>
        <span class="stats-value stats-time" id="stats-best-time">00:00:00.000</span>
      </div>
      
      <div class="stats-row">
        <span class="stats-label" id="stats-total-wins-label">Total Wins:</span>
        <span class="stats-value" id="stats-total-wins">0</span>
      </div>
      
      <div class="stats-row">
        <span class="stats-label" id="stats-total-games-label">Total Games:</span>
        <span class="stats-value" id="stats-total-games">0</span>
      </div>
      
      <div class="stats-row">
        <span class="stats-label" id="stats-win-rate-label">Win Rate:</span>
        <span class="stats-value" id="stats-win-rate">0%</span>
      </div>
      
      <div class="stats-row">
        <span class="stats-label" id="stats-play-time-label">Play Time:</span>
        <span class="stats-value stats-time" id="stats-play-time">0d 0h 0m 0s</span>
      </div>
      
      <div class="stats-row">
        <span class="stats-label" id="stats-avg-time-label">Average Time:</span>
        <span class="stats-value stats-time" id="stats-avg-time">00:00:00.000</span>
      </div>
      
      <div class="stats-row">
        <span class="stats-label" id="stats-last-win-label">Last Win:</span>
        <span class="stats-value" id="stats-last-win">Never</span>
      </div>
    </div>
    
    <button id="reset-stats" class="game-btn full-width" style="background-color: #ff6b6b;">Reset Statistics</button>
    <button id="close-stats" class="game-btn full-width">Close</button>
  </div>
</div>

<div id="modal-confirm">
  <div class="modal-box">
    <h2 id="confirm-title">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ</h2>
    <p id="confirm-text">–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —Å–±—Ä–æ—Å–∏—Ç—å –≤—Å—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É?</p>
    <div style="display: flex; gap: 10px; margin-top: 20px;">
      <button id="confirm-yes" class="game-btn" style="flex: 1; background-color: #28a745;">–î–∞</button>
      <button id="confirm-no" class="game-btn" style="flex: 1; background-color: #dc3545;">–ù–µ—Ç</button>
    </div>
  </div>
</div>

<script>
  const cardSymbols = ['üçé','üçå','üçá','üçì','üçç','ü•ù','üçí','ü••','üçâ','üçë','ü•≠','üçê','üçã','üçä','üçà','üçÖ','üçÜ','ü•ï','üåΩ','ü•î','ü•í','ü•¨','üå∂Ô∏è','üßÑ','üßÖ','üçÑ','ü•ú','üå∞','ü•ë','üçû','üßÄ','üçó','üçñ','ü•©','üç§','üçô','üçö','ü•®','ü•Ø','üçî','üçü','üå≠','üçï','ü•™','üåÆ','üåØ','ü•ó','ü•´','üç¶','üç∞'];
  
const translations = {
    ru: { 
      title: "–ù–∞–π–¥–∏ –ø–∞—Ä—ã", 
      easy: "–õ–µ–≥–∫–æ", 
      norm: "–ù–æ—Ä–º–∞–ª—å–Ω–æ", 
      hard: "–°–ª–æ–∂–Ω–æ", 
      extr: "–≠–∫—Å—Ç—Ä–∏–º", 
      win: "–ú–æ–ª–æ–¥–µ—Ü, —Ç—ã –≤—ã–∏–≥—Ä–∞–ª!", 
      again: "–ò–≥—Ä–∞—Ç—å –µ—â—ë —Ä–∞–∑", 
      exit: "–í—ã–π—Ç–∏", 
      st: "–ù–∞—Å—Ç—Ä–æ–π–∫–∏", 
      lang: "–Ø–∑—ã–∫:", 
      sndOn: "–ú—É–∑—ã–∫–∞: –í–ö–õ", 
      sndOff: "–ú—É–∑—ã–∫–∞: –í–´–ö–õ", 
      match: "–ü–∞—Ä–∞ –Ω–∞–π–¥–µ–Ω–∞!", 
      ok: "–û–ö",
      musicVol: "–ì—Ä–æ–º–∫–æ—Å—Ç—å –º—É–∑—ã–∫–∏:",
      effectsVol: "–ì—Ä–æ–º–∫–æ—Å—Ç—å —ç—Ñ—Ñ–µ–∫—Ç–æ–≤:",
      timerOn: "–¢–∞–π–º–µ—Ä: –í–ö–õ",
      timerOff: "–¢–∞–π–º–µ—Ä: –í–´–ö–õ",
      stats: "–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞",
      statsTitle: "üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–≥—Ä—ã",
      bestTime: "–õ—É—á—à–µ–µ –≤—Ä–µ–º—è:",
      totalWins: "–í—Å–µ–≥–æ –ø–æ–±–µ–¥:",
      totalGames: "–í—Å–µ–≥–æ –∏–≥—Ä:",
      winRate: "–ü—Ä–æ—Ü–µ–Ω—Ç –ø–æ–±–µ–¥:",
      playTime: "–í—Ä–µ–º—è –≤ –∏–≥—Ä–µ:",
      avgTime: "–°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è:",
      lastWin: "–ü–æ—Å–ª–µ–¥–Ω—è—è –ø–æ–±–µ–¥–∞:",
      never: "–ù–∏–∫–æ–≥–¥–∞",
      resetStats: "–°–±—Ä–æ—Å–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É",
      close: "–ó–∞–∫—Ä—ã—Ç—å",
      confirmTitle: "–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ",
      confirmText: "–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —Å–±—Ä–æ—Å–∏—Ç—å –≤—Å—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É?",
      yes: "–î–∞",
      no: "–ù–µ—Ç",
      musicTitle: "–ú—É–∑—ã–∫–∞",
      musicText: "–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –≥—Ä–æ–º–∫–æ—Å—Ç—å –º—É–∑—ã–∫–∏ –∏ —ç—Ñ—Ñ–µ–∫—Ç–æ–≤",
      settingsBtn: "–ù–∞—Å—Ç—Ä–æ–π–∫–∏",
      statsBtn: "–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞",
      timerLabel: "–¢–∞–π–º–µ—Ä"
    },
    en: { 
      title: "Find Pairs", 
      easy: "Easy", 
      norm: "Normal", 
      hard: "Hard", 
      extr: "Extreme", 
      win: "Well done, you won!", 
      again: "Play Again", 
      exit: "Exit", 
      st: "Settings", 
      lang: "Language:", 
      sndOn: "Music: ON", 
      sndOff: "Music: OFF", 
      match: "Match found!", 
      ok: "OK",
      musicVol: "Music Volume:",
      effectsVol: "Effects Volume:",
      timerOn: "Timer: ON",
      timerOff: "Timer: OFF",
      stats: "Statistics",
      statsTitle: "üìà Game Statistics",
      bestTime: "Best Time:",
      totalWins: "Total Wins:",
      totalGames: "Total Games:",
      winRate: "Win Rate:",
      playTime: "Play Time:",
      avgTime: "Average Time:",
      lastWin: "Last Win:",
      never: "Never",
      resetStats: "Reset Statistics",
      close: "Close",
      confirmTitle: "Confirm Action",
      confirmText: "Are you sure you want to reset all statistics?",
      yes: "Yes",
      no: "No",
      musicTitle: "Music",
      musicText: "Adjust music and effects volume",
      settingsBtn: "Settings",
      statsBtn: "Statistics",
      timerLabel: "Timer"
    },
    ua: { 
      title: "–ó–Ω–∞–π–¥–∏ –ø–∞—Ä–∏", 
      easy: "–õ–µ–≥–∫–æ", 
      norm: "–ù–æ—Ä–º–∞–ª—å–Ω–æ", 
      hard: "–°–∫–ª–∞–¥–Ω–æ", 
      extr: "–ï–∫—Å—Ç—Ä–∏–º", 
      win: "–ú–æ–ª–æ–¥–µ—Ü—å, —Ç–∏ –≤–∏–≥—Ä–∞–≤!", 
      again: "–ì—Ä–∞—Ç–∏ —â–µ —Ä–∞–∑", 
      exit: "–í–∏–π—Ç–∏", 
      st: "–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è", 
      lang: "–ú–æ–≤–∞:", 
      sndOn: "–ú—É–∑–∏–∫–∞: –í–ö–õ", 
      sndOff: "–ú—É–∑–∏–∫–∞: –í–ò–ú–ö", 
      match: "–ü–∞—Ä—É –∑–Ω–∞–π–¥–µ–Ω–æ!", 
      ok: "–î–æ–±—Ä–µ",
      musicVol: "–ì—É—á–Ω—ñ—Å—Ç—å –º—É–∑–∏–∫–∏:",
      effectsVol: "–ì—É—á–Ω—ñ—Å—Ç—å –µ—Ñ–µ–∫—Ç—ñ–≤:",
      timerOn: "–¢–∞–π–º–µ—Ä: –í–ö–õ",
      timerOff: "–¢–∞–π–º–µ—Ä: –í–ò–ú–ö",
      stats: "–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞",
      statsTitle: "üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≥—Ä–∏",
      bestTime: "–ù–∞–π–∫—Ä–∞—â–∏–π —á–∞—Å:",
      totalWins: "–í—Å—å–æ–≥–æ –ø–µ—Ä–µ–º–æ–≥:",
      totalGames: "–í—Å—å–æ–≥–æ —ñ–≥–æ—Ä:",
      winRate: "–í—ñ–¥—Å–æ—Ç–æ–∫ –ø–µ—Ä–µ–º–æ–≥:",
      playTime: "–ß–∞—Å –≥—Ä–∏:",
      avgTime: "–°–µ—Ä–µ–¥–Ω—ñ–π —á–∞—Å:",
      lastWin: "–û—Å—Ç–∞–Ω–Ω—è –ø–µ—Ä–µ–º–æ–≥–∞:",
      never: "–ù—ñ–∫–æ–ª–∏",
      resetStats: "–°–∫–∏–Ω—É—Ç–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É",
      close: "–ó–∞–∫—Ä–∏—Ç–∏",
      confirmTitle: "–ü—ñ–¥—Ç–≤–µ—Ä–¥—ñ—Ç—å –¥—ñ—é",
      confirmText: "–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ —Å–∫–∏–Ω—É—Ç–∏ –≤—Å—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É?",
      yes: "–¢–∞–∫",
      no: "–ù—ñ",
      musicTitle: "–ú—É–∑–∏–∫–∞",
      musicText: "–ù–∞–ª–∞—à—Ç—É–π—Ç–µ –≥—É—á–Ω—ñ—Å—Ç—å –º—É–∑–∏–∫–∏ —Ç–∞ –µ—Ñ–µ–∫—Ç—ñ–≤",
      settingsBtn: "–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è",
      statsBtn: "–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞",
      timerLabel: "–¢–∞–π–º–µ—Ä"
    },
    by: { 
      title: "–ó–Ω–∞–π–¥–∑—ñ –ø–∞—Ä—ã", 
      easy: "–õ—ë–≥–∫–∞", 
      norm: "–ù–∞—Ä–º–∞–ª—å–Ω–∞", 
      hard: "–°–∫–ª–∞–¥–∞–Ω–∞", 
      extr: "–≠–∫—Å—Ç—Ä—ã–º", 
      win: "–ú–∞–ª–∞–¥–∑–µ—Ü, —Ç—ã –≤—ã–π–≥—Ä–∞—û!", 
      again: "–ì—É–ª—è—Ü—å —è—à—á—ç —Ä–∞–∑", 
      exit: "–í—ã–π—Å—Ü—ñ", 
      st: "–ù–∞–ª–∞–¥—ã", 
      lang: "–ú–æ–≤–∞:", 
      sndOn: "–ú—É–∑—ã–∫–∞: –í–ö–õ", 
      sndOff: "–ú—É–∑—ã–∫–∞: –í–´–ö–õ", 
      match: "–ü–∞—Ä–∞ –∑–Ω–æ–π–¥–∑–µ–Ω–∞!", 
      ok: "–û–ö",
      musicVol: "–ì—É—á–Ω–∞—Å—Ü—å –º—É–∑—ã–∫—ñ:",
      effectsVol: "–ì—É—á–Ω–∞—Å—Ü—å —ç—Ñ–µ–∫—Ç–∞—û:",
      timerOn: "–¢–∞–π–º–µ—Ä: –í–ö–õ",
      timerOff: "–¢–∞–π–º–µ—Ä: –í–´–ö–õ",
      stats: "–°—Ç–∞—Ç—ã—Å—Ç—ã–∫–∞",
      statsTitle: "üìà –°—Ç–∞—Ç—ã—Å—Ç—ã–∫–∞ –≥—É–ª—å–Ω—ñ",
      bestTime: "–õ–µ–ø—à—ã —á–∞—Å:",
      totalWins: "–£—Å—è–≥–æ –ø–µ—Ä–∞–º–æ–≥:",
      totalGames: "–£—Å—è–≥–æ –≥—É–ª—å–Ω—è—û:",
      winRate: "–ê–¥—Å–æ—Ç–∞–∫ –ø–µ—Ä–∞–º–æ–≥:",
      playTime: "–ß–∞—Å –≥—É–ª—å–Ω—ñ:",
      avgTime: "–°—è—Ä—ç–¥–Ω—ñ —á–∞—Å:",
      lastWin: "–ê–ø–æ—à–Ω—è—è –ø–µ—Ä–∞–º–æ–≥–∞:",
      never: "–ù—ñ–∫–æ–ª—ñ",
      resetStats: "–°–∫—ñ–Ω—É—Ü—å —Å—Ç–∞—Ç—ã—Å—Ç—ã–∫—É",
      close: "–ó–∞–∫—Ä—ã—Ü—å",
      confirmTitle: "–ü–∞—Ü–≤–µ—Ä–¥–∑—ñ—Ü–µ –¥–∑–µ—è–Ω–Ω–µ",
      confirmText: "–í—ã —û–ø—ç—û–Ω–µ–Ω—ã, —à—Ç–æ —Ö–æ—á–∞—Ü–µ —Å–∫—ñ–Ω—É—Ü—å —É—Å—é —Å—Ç–∞—Ç—ã—Å—Ç—ã–∫—É?",
      yes: "–¢–∞–∫",
      no: "–ù–µ",
      musicTitle: "–ú—É–∑—ã–∫–∞",
      musicText: "–ù–∞–ª–∞–¥–∑—å—Ü–µ –≥—É—á–Ω–∞—Å—Ü—å –º—É–∑—ã–∫—ñ —ñ —ç—Ñ–µ–∫—Ç–∞—û",
      settingsBtn: "–ù–∞–ª–∞–¥—ã",
      statsBtn: "–°—Ç–∞—Ç—ã—Å—Ç—ã–∫–∞",
      timerLabel: "–¢–∞–π–º–µ—Ä"
    },
    it: { 
      title: "Trova le coppie", 
      easy: "Facile", 
      norm: "Normale", 
      hard: "Difficile", 
      extr: "Estremo", 
      win: "Bravo, hai vinto!", 
      again: "Gioca ancora", 
      exit: "Esci", 
      st: "Impostazioni", 
      lang: "Lingua:", 
      sndOn: "Musica: ON", 
      sndOff: "Musica: OFF", 
      match: "Coppia trovata!", 
      ok: "OK",
      musicVol: "Volume Musica:",
      effectsVol: "Volume Effetti:",
      timerOn: "Timer: ON",
      timerOff: "Timer: OFF",
      stats: "Statistiche",
      statsTitle: "üìà Statistiche di Gioco",
      bestTime: "Miglior tempo:",
      totalWins: "Vittorie totali:",
      totalGames: "Partite totali:",
      winRate: "Percentuale vittorie:",
      playTime: "Tempo di gioco:",
      avgTime: "Tempo medio:",
      lastWin: "Ultima vittoria:",
      never: "Mai",
      resetStats: "Reset Statistiche",
      close: "Chiudi",
      confirmTitle: "Conferma Azione",
      confirmText: "Sei sicuro di voler resettare tutte le statistiche?",
      yes: "S√¨",
      no: "No",
      musicTitle: "Musica",
      musicText: "Regola il volume della musica e degli effetti",
      settingsBtn: "Impostazioni",
      statsBtn: "Statistiche",
      timerLabel: "Timer"
    },
    es: { 
      title: "Encontrar pares", 
      easy: "F√°cil", 
      norm: "Normal", 
      hard: "Dif√≠cil", 
      extr: "Extremo", 
      win: "¬°Bien hecho, ganaste!", 
      again: "Jugar de nuevo", 
      exit: "Salir", 
      st: "Ajustes", 
      lang: "Idioma:", 
      sndOn: "M√∫sica: ON", 
      sndOff: "M√∫sica: OFF", 
      match: "¬°Pareja encontrada!", 
      ok: "Aceptar",
      musicVol: "Volumen M√∫sica:",
      effectsVol: "Volumen Efectos:",
      timerOn: "Timer: ON",
      timerOff: "Timer: OFF",
      stats: "Estad√≠sticas",
      statsTitle: "üìà Estad√≠sticas del Juego",
      bestTime: "Mejor tiempo:",
      totalWins: "Victorias totales:",
      totalGames: "Juegos totales:",
      winRate: "Porcentaje victorias:",
      playTime: "Tiempo jugado:",
      avgTime: "Tiempo promedio:",
      lastWin: "√öltima victoria:",
      never: "Nunca",
      resetStats: "Restablecer estad√≠sticas",
      close: "Cerrar",
      confirmTitle: "Confirmar Acci√≥n",
      confirmText: "¬øEst√°s seguro de que quieres restablecer todas las estad√≠sticas?",
      yes: "S√≠",
      no: "No",
      musicTitle: "M√∫sica",
      musicText: "Ajusta el volumen de la m√∫sica y los efectos",
      settingsBtn: "Ajustes",
      statsBtn: "Estad√≠sticas",
      timerLabel: "Temporizador"
    },
    ar: { 
      title: "ÿßŸÑÿ®ÿ≠ÿ´ ÿπŸÜ ÿßŸÑÿ£ÿ≤Ÿàÿßÿ¨", 
      easy: "ÿ≥ŸáŸÑ", 
      norm: "ÿπÿßÿØŸä", 
      hard: "ÿµÿπÿ®", 
      extr: "ÿ£ŸÇÿµŸâ", 
      win: "ÿ£ÿ≠ÿ≥ŸÜÿ™ÿå ŸÑŸÇÿØ ŸÅÿ≤ÿ™!", 
      again: "ÿßŸÑÿπÿ® ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ", 
      exit: "ÿÆÿ±Ÿàÿ¨", 
      st: "ÿ•ÿπÿØÿßÿØÿßÿ™", 
      lang: "ÿßŸÑŸÑÿ∫ÿ©:", 
      sndOn: "ŸÖŸàÿ≥ŸäŸÇŸâ: ÿ™ŸÅÿπŸäŸÑ", 
      sndOff: "ŸÖŸàÿ≥ŸäŸÇŸâ: ÿ™ÿπÿ∑ŸäŸÑ", 
      match: "ÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ ÿ≤Ÿàÿ¨!", 
      ok: "ŸÖŸàÿßŸÅŸÇ",
      musicVol: "ŸÖÿ≥ÿ™ŸàŸâ ÿµŸàÿ™ ÿßŸÑŸÖŸàÿ≥ŸäŸÇŸâ:",
      effectsVol: "ŸÖÿ≥ÿ™ŸàŸâ ÿµŸàÿ™ ÿßŸÑŸÖÿ§ÿ´ÿ±ÿßÿ™:",
      timerOn: "ÿßŸÑŸÖŸàŸÇÿ™: ÿ™ÿ¥ÿ∫ŸäŸÑ",
      timerOff: "ÿßŸÑŸÖŸàŸÇÿ™: ÿ•ŸäŸÇÿßŸÅ",
      stats: "ÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™",
      statsTitle: "üìà ÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ ÿßŸÑŸÑÿπÿ®ÿ©",
      bestTime: "ÿ£ŸÅÿ∂ŸÑ ŸàŸÇÿ™:",
      totalWins: "ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑÿßŸÜÿ™ÿµÿßÿ±ÿßÿ™:",
      totalGames: "ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑÿ£ŸÑÿπÿßÿ®:",
      winRate: "ŸÖÿπÿØŸÑ ÿßŸÑŸÅŸàÿ≤:",
      playTime: "ŸàŸÇÿ™ ÿßŸÑŸÑÿπÿ®:",
      avgTime: "ŸÖÿ™Ÿàÿ≥ÿ∑ ÿßŸÑŸàŸÇÿ™:",
      lastWin: "ÿ¢ÿÆÿ± ŸÅŸàÿ≤:",
      never: "ÿ£ÿ®ÿØÿßŸã",
      resetStats: "ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™",
      close: "ÿ•ÿ∫ŸÑÿßŸÇ",
      confirmTitle: "ÿ™ÿ£ŸÉŸäÿØ ÿßŸÑÿ•ÿ¨ÿ±ÿßÿ°",
      confirmText: "ŸáŸÑ ÿ£ŸÜÿ™ ŸÖÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ£ŸÜŸÉ ÿ™ÿ±ŸäÿØ ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™?",
      yes: "ŸÜÿπŸÖ",
      no: "ŸÑÿß",
      musicTitle: "ŸÖŸàÿ≥ŸäŸÇŸâ",
      musicText: "ÿ∂ÿ®ÿ∑ ŸÖÿ≥ÿ™ŸàŸâ ÿµŸàÿ™ ÿßŸÑŸÖŸàÿ≥ŸäŸÇŸâ ŸàÿßŸÑŸÖÿ§ÿ´ÿ±ÿßÿ™",
      settingsBtn: "ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™",
      statsBtn: "ÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™",
      timerLabel: "ÿßŸÑŸÖŸàŸÇÿ™"
    },
    zh: { 
      title: "ÈÖçÂØπÊ∏∏Êàè", 
      easy: "ÁÆÄÂçï", 
      norm: "ÊôÆÈÄö", 
      hard: "Âõ∞Èöæ", 
      extr: "ÊûÅÈôê", 
      win: "Â§™Ê£í‰∫Ü, ‰Ω†Ëµ¢‰∫Ü!", 
      again: "ÂÜçÁé©‰∏ÄÊ¨°", 
      exit: "ÈÄÄÂá∫", 
      st: "ËÆæÁΩÆ", 
      lang: "ËØ≠Ë®Ä:", 
      sndOn: "Èü≥‰πê: ÂºÄÂêØ", 
      sndOff: "Èü≥‰πê: ÂÖ≥Èó≠", 
      match: "ÈÖçÂØπÊàêÂäü!", 
      ok: "Á°ÆÂÆö",
      musicVol: "Èü≥‰πêÈü≥Èáè:",
      effectsVol: "ÊïàÊûúÈü≥Èáè:",
      timerOn: "ËÆ°Êó∂Âô®: ÂºÄÂêØ",
      timerOff: "ËÆ°Êó∂Âô®: ÂÖ≥Èó≠",
      stats: "ÁªüËÆ°",
      statsTitle: "üìà Ê∏∏ÊàèÁªüËÆ°",
      bestTime: "ÊúÄ‰Ω≥Êó∂Èó¥:",
      totalWins: "ÊÄªËÉúÂà©:",
      totalGames: "ÊÄªÊ∏∏Êàè:",
      winRate: "ËÉúÁéá:",
      playTime: "Ê∏∏ÊàèÊó∂Èó¥:",
      avgTime: "Âπ≥ÂùáÊó∂Èó¥:",
      lastWin: "ÊúÄÂêéËÉúÂà©:",
      never: "‰ªéÊú™",
      resetStats: "ÈáçÁΩÆÁªüËÆ°",
      close: "ÂÖ≥Èó≠",
      confirmTitle: "Á°ÆËÆ§Êìç‰Ωú",
      confirmText: "ÊÇ®Á°ÆÂÆöË¶ÅÈáçÁΩÆÊâÄÊúâÁªüËÆ°Âêó?",
      yes: "ÊòØ",
      no: "Âê¶",
      musicTitle: "Èü≥‰πê",
      musicText: "Ë∞ÉÊï¥Èü≥‰πêÂíåÊïàÊûúÈü≥Èáè",
      settingsBtn: "ËÆæÁΩÆ",
      statsBtn: "ÁªüËÆ°",
      timerLabel: "ËÆ°Êó∂Âô®"
    },
    jp: { 
      title: "„Éö„Ç¢Êé¢„Åó", 
      easy: "Á∞°Âçò", 
      norm: "ÊôÆÈÄö", 
      hard: "Èõ£„Åó„ÅÑ", 
      extr: "„Ç®„ÇØ„Çπ„Éà„É™„Éº„É†", 
      win: "„ÇÑ„Å£„Åü„Å≠, „ÅÇ„Å™„Åü„ÅÆÂãù„Å°!", 
      again: "„ÇÇ„ÅÜ‰∏ÄÂ∫¶ÈÅä„Å∂", 
      exit: "ÁµÇ‰∫Ü", 
      st: "Ë®≠ÂÆö", 
      lang: "Ë®ÄË™û:", 
      sndOn: "Èü≥Ê•Ω: „Ç™„É≥", 
      sndOff: "Èü≥Ê•Ω: „Ç™„Éï", 
      match: "„Éö„Ç¢„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åó„Åü!", 
      ok: "Á¢∫Ë™ç",
      musicVol: "Èü≥Ê•Ω„ÅÆÈü≥Èáè:",
      effectsVol: "ÂäπÊûúÈü≥„ÅÆÈü≥Èáè:",
      timerOn: "„Çø„Ç§„Éû„Éº: „Ç™„É≥",
      timerOff: "„Çø„Ç§„Éû„Éº: „Ç™„Éï",
      stats: "Áµ±Ë®à",
      statsTitle: "üìà „Ç≤„Éº„É†Áµ±Ë®à",
      bestTime: "„Éô„Çπ„Éà„Çø„Ç§„É†:",
      totalWins: "Á∑èÂãùÂà©Êï∞:",
      totalGames: "Á∑è„Ç≤„Éº„É†Êï∞:",
      winRate: "ÂãùÁéá:",
      playTime: "„Éó„É¨„Ç§ÊôÇÈñì:",
      avgTime: "Âπ≥ÂùáÊôÇÈñì:",
      lastWin: "ÊúÄÁµÇÂãùÂà©:",
      never: "‰∏ÄÂ∫¶„ÇÇ„Å™„ÅÑ",
      resetStats: "Áµ±Ë®à„Çí„É™„Çª„ÉÉ„Éà",
      close: "Èñâ„Åò„Çã",
      confirmTitle: "„Ç¢„ÇØ„Ç∑„Éß„É≥„ÇíÁ¢∫Ë™ç",
      confirmText: "„Åô„Åπ„Å¶„ÅÆÁµ±Ë®à„Çí„É™„Çª„ÉÉ„Éà„Åó„Å¶„ÇÇ„Çà„Çç„Åó„ÅÑ„Åß„Åô„Åã?",
      yes: "„ÅØ„ÅÑ",
      no: "„ÅÑ„ÅÑ„Åà",
      musicTitle: "Èü≥Ê•Ω",
      musicText: "Èü≥Ê•Ω„Å®ÂäπÊûúÈü≥„ÅÆÈü≥Èáè„ÇíË™øÊï¥",
      settingsBtn: "Ë®≠ÂÆö",
      statsBtn: "Áµ±Ë®à",
      timerLabel: "„Çø„Ç§„Éû„Éº"
    },
    de: { 
      title: "Paare finden", 
      easy: "Einfach", 
      norm: "Normal", 
      hard: "Schwer", 
      extr: "Extrem", 
      win: "Gut gemacht, du hast gewonnen!", 
      again: "Nochmal spielen", 
      exit: "Beenden", 
      st: "Einstellungen", 
      lang: "Sprache:", 
      sndOn: "Musik: EIN", 
      sndOff: "Musik: AUS", 
      match: "Paar gefunden!", 
      ok: "OK",
      musicVol: "Musiklautst√§rke:",
      effectsVol: "Effektlautst√§rke:",
      timerOn: "Timer: EIN",
      timerOff: "Timer: AUS",
      stats: "Statistiken",
      statsTitle: "üìà Spielstatistiken",
      bestTime: "Beste Zeit:",
      totalWins: "Gesamtsiege:",
      totalGames: "Gesamtspiele:",
      winRate: "Gewinnrate:",
      playTime: "Spielzeit:",
      avgTime: "Durchschnittszeit:",
      lastWin: "Letzter Sieg:",
      never: "Nie",
      resetStats: "Statistiken zur√ºcksetzen",
      close: "Schlie√üen",
      confirmTitle: "Aktion best√§tigen",
      confirmText: "Sind Sie sicher, dass Sie alle Statistiken zur√ºcksetzen m√∂chten?",
      yes: "Ja",
      no: "Nein",
      musicTitle: "Musik",
      musicText: "Musik- und Effektlautst√§rke einstellen",
      settingsBtn: "Einstellungen",
      statsBtn: "Statistiken",
      timerLabel: "Timer"
    }
  };

  let firstCard = null, secondCard = null, lockBoard = false;
  let matchedPairs = 0, totalPairs = 0, currentCols = 0;
  let currentLang = 'en', musicEnabled = false, timerEnabled = false, timerRunning = false;
  let musicVolume = 0.5, effectsVolume = 0.7;
  let timerStartTime = 0, timerInterval = null, elapsedTime = 0;
  let gameStarted = false;
  
  let stats = {
    bestTime: Infinity,
    totalWins: 0,
    totalGames: 0,
    totalPlayTime: 0,
    gameTimes: [],
    lastWinTime: null,
    sessionStartTime: Date.now()
  };

  const gameBoard = document.getElementById('game-board');
  const messageBox = document.getElementById('message');
  const modal = document.getElementById('modal');
  const modalSt = document.getElementById('modal-settings');
  const modalStats = document.getElementById('modal-stats');
  const modalConfirm = document.getElementById('modal-confirm');
  const soundToggle = document.getElementById('sound-toggle');
  const timerToggle = document.getElementById('timer-toggle');
  const langSelect = document.getElementById('lang-select');
  const timerContainer = document.getElementById('timer-container');
  const statsBtn = document.getElementById('stats-btn');
  const resetStatsBtn = document.getElementById('reset-stats');
  const confirmYesBtn = document.getElementById('confirm-yes');
  const confirmNoBtn = document.getElementById('confirm-no');
  
  const soundFlip = new Audio('dostavanie_karti.mp3');
  const soundTap = new Audio('tap.mp3');
  const soundMatch = new Audio('pravilna_para.mp3');
  const soundWin = new Audio('pobeda.mp3');
  const soundLose = new Audio('proigral.mp3');
  const soundWarning = new Audio('warning.mp3');
  
  const bgMusic = new Audio('music.mp3');
  bgMusic.loop = true;
  bgMusic.volume = musicVolume;

  function loadSettings() {
    try {
      const saved = localStorage.getItem('pairsGameSettings');
      if (saved) {
        const parsed = JSON.parse(saved);
        currentLang = parsed.language || 'en';
        musicEnabled = parsed.musicEnabled || false;
        timerEnabled = parsed.timerEnabled || false;
        musicVolume = parsed.musicVolume || 0.5;
        effectsVolume = parsed.effectsVolume || 0.7;
        
        langSelect.value = currentLang;
        document.getElementById('music-volume').value = musicVolume * 100;
        document.getElementById('effects-volume').value = effectsVolume * 100;
        
        if (timerEnabled) {
          timerContainer.style.display = 'block';
        }
        
        updateVolumes();
        toggleBgMusic();
      }
    } catch (e) {
      console.log('Failed to load settings');
    }
  }

  function saveSettings() {
    try {
      localStorage.setItem('pairsGameSettings', JSON.stringify({
        language: currentLang,
        musicEnabled: musicEnabled,
        timerEnabled: timerEnabled,
        musicVolume: musicVolume,
        effectsVolume: effectsVolume
      }));
    } catch (e) {
      console.log('Failed to save settings');
    }
  }

  function loadStats() {
    try {
      const saved = localStorage.getItem('pairsGameStats');
      if (saved) {
        const parsed = JSON.parse(saved);
        stats.bestTime = parsed.bestTime || Infinity;
        stats.totalWins = parsed.totalWins || 0;
        stats.totalGames = parsed.totalGames || 0;
        stats.totalPlayTime = parsed.totalPlayTime || 0;
        stats.gameTimes = parsed.gameTimes || [];
        stats.lastWinTime = parsed.lastWinTime || null;
        stats.sessionStartTime = Date.now();
        
        updateStatsDisplay();
      }
    } catch (e) {
      console.log('Failed to load stats');
    }
  }

  function saveStats() {
    try {
      const totalPlayTimeWithCurrent = stats.totalPlayTime + (Date.now() - stats.sessionStartTime);
      
      localStorage.setItem('pairsGameStats', JSON.stringify({
        bestTime: stats.bestTime,
        totalWins: stats.totalWins,
        totalGames: stats.totalGames,
        totalPlayTime: totalPlayTimeWithCurrent,
        gameTimes: stats.gameTimes,
        lastWinTime: stats.lastWinTime
      }));
    } catch (e) {
      console.log('Failed to save stats');
    }
  }

  function formatTime(ms) {
    const totalSeconds = Math.floor(ms / 1000);
    const hours = Math.floor(totalSeconds / 3600);
    const minutes = Math.floor((totalSeconds % 3600) / 60);
    const seconds = totalSeconds % 60;
    const milliseconds = ms % 1000;
    
    if (hours > 0) {
      return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}.${milliseconds.toString().padStart(3, '0').slice(0, 3)}`;
    } else {
      return `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}.${milliseconds.toString().padStart(3, '0').slice(0, 3)}`;
    }
  }

  function formatPlayTime(ms) {
    const totalSeconds = Math.floor(ms / 1000);
    const days = Math.floor(totalSeconds / 86400);
    const hours = Math.floor((totalSeconds % 86400) / 3600);
    const minutes = Math.floor((totalSeconds % 3600) / 60);
    const seconds = totalSeconds % 60;
    
    if (days > 0) {
      return `${days}d ${hours}h ${minutes}m ${seconds}s`;
    } else if (hours > 0) {
      return `${hours}h ${minutes}m ${seconds}s`;
    } else if (minutes > 0) {
      return `${minutes}m ${seconds}s`;
    } else {
      return `${seconds}s`;
    }
  }

  function updateStatsDisplay() {
    const t = translations[currentLang] || translations.en;
    
    document.getElementById('stats-header').textContent = t.stats;
    document.getElementById('stats-title').textContent = t.statsTitle;
    document.getElementById('stats-best-time-label').textContent = t.bestTime;
    document.getElementById('stats-total-wins-label').textContent = t.totalWins;
    document.getElementById('stats-total-games-label').textContent = t.totalGames;
    document.getElementById('stats-win-rate-label').textContent = t.winRate;
    document.getElementById('stats-play-time-label').textContent = t.playTime;
    document.getElementById('stats-avg-time-label').textContent = t.avgTime;
    document.getElementById('stats-last-win-label').textContent = t.lastWin;
    document.getElementById('reset-stats').textContent = t.resetStats;
    document.getElementById('close-stats').textContent = t.close;
    
    document.getElementById('confirm-title').textContent = t.confirmTitle;
    document.getElementById('confirm-text').textContent = t.confirmText;
    document.getElementById('confirm-yes').textContent = t.yes;
    document.getElementById('confirm-no').textContent = t.no;
    
    const bestTime = stats.bestTime === Infinity ? "00:00:00.000" : formatTime(stats.bestTime);
    document.getElementById('stats-best-time').textContent = bestTime;
    
    document.getElementById('stats-total-wins').textContent = stats.totalWins;
    document.getElementById('stats-total-games').textContent = stats.totalGames;
    
    const winRate = stats.totalGames > 0 ? Math.round((stats.totalWins / stats.totalGames) * 100) : 0;
    document.getElementById('stats-win-rate').textContent = `${winRate}%`;
    
    const currentPlayTime = stats.totalPlayTime + (Date.now() - stats.sessionStartTime);
    document.getElementById('stats-play-time').textContent = formatPlayTime(currentPlayTime);
    
    const avgTime = stats.gameTimes.length > 0 ? 
      formatTime(stats.gameTimes.reduce((a, b) => a + b, 0) / stats.gameTimes.length) : 
      "00:00:00.000";
    document.getElementById('stats-avg-time').textContent = avgTime;
    
    const lastWin = stats.lastWinTime ? 
      new Date(stats.lastWinTime).toLocaleDateString() + ' ' + new Date(stats.lastWinTime).toLocaleTimeString() : 
      t.never;
    document.getElementById('stats-last-win').textContent = lastWin;
  }

  function updateStatsInterval() {
    updateStatsDisplay();
    setTimeout(updateStatsInterval, 1000);
  }

  function updateVolumes() {
    bgMusic.volume = musicVolume;
    soundFlip.volume = effectsVolume;
    soundTap.volume = effectsVolume;
    soundMatch.volume = effectsVolume;
    soundWin.volume = effectsVolume;
    soundLose.volume = effectsVolume;
    soundWarning.volume = effectsVolume;
  }

  function playEffect(audio) {
    audio.currentTime = 0;
    audio.volume = effectsVolume;
    audio.play().catch(()=>{});
  }

  function toggleBgMusic() {
    if (musicEnabled) {
      bgMusic.play().catch(e => {});
    } else {
      bgMusic.pause();
    }
  }

  function updateTimerDisplay() {
    if (!timerEnabled) return;
    
    const timerDisplay = document.getElementById('timer-display');
    
    if (timerRunning) {
      const now = Date.now();
      elapsedTime = now - timerStartTime;
    }
    
    const totalMs = elapsedTime;
    const hours = Math.floor(totalMs / 3600000);
    const minutes = Math.floor((totalMs % 3600000) / 60000);
    const seconds = Math.floor((totalMs % 60000) / 1000);
    const milliseconds = totalMs % 1000;
    
    timerDisplay.textContent = 
      `${hours.toString().padStart(2, '0')}:` +
      `${minutes.toString().padStart(2, '0')}:` +
      `${seconds.toString().padStart(2, '0')}.` +
      `${milliseconds.toString().padStart(3, '0').slice(0, 3)}`;
  }

  function startTimer() {
    if (!timerEnabled || timerRunning || !gameStarted) return;
    timerStartTime = Date.now();
    timerRunning = true;
    timerContainer.style.display = 'block';
    
    if (timerInterval) clearInterval(timerInterval);
    timerInterval = setInterval(updateTimerDisplay, 50);
  }

  function stopTimer() {
    timerRunning = false;
    gameStarted = false;
    if (timerInterval) {
      clearInterval(timerInterval);
      timerInterval = null;
    }
  }

  function resetTimer() {
    stopTimer();
    elapsedTime = 0;
    updateTimerDisplay();
  }

  function toggleTimer() {
    timerEnabled = !timerEnabled;
    playEffect(soundTap);
    updateUI();
    
    if (timerEnabled) {
        resetTimer();
        timerContainer.style.display = 'block';
    } else {
        resetTimer();
        timerContainer.style.display = 'none';
    }
    
    saveSettings();
  }

  function shuffle(array) {
    return array.sort(() => Math.random() - 0.5);
  }

  function shuffleRemaining() {
    const cards = Array.from(document.querySelectorAll('.card')).filter(c => c.style.opacity !== '0');
    if (cards.length === 0) return;

    const shuffled = shuffle([...cards]);
    
    shuffled.forEach((card, index) => {
      const row = Math.floor(index / currentCols) + 1;
      const col = (index % currentCols) + 1;
      card.style.gridArea = `${row} / ${col} / ${row + 1} / ${col + 1}`;
      card.style.transform = "scale(1.05)";
      setTimeout(() => card.style.transform = "scale(1)", 300);
    });
  }

  function updateUI() {
    const t = translations[currentLang] || translations.en;
    
    document.getElementById('main-title').textContent = t.title;
    document.getElementById('btn-easy').textContent = t.easy;
    document.getElementById('btn-norm').textContent = t.norm;
    document.getElementById('btn-hard').textContent = t.hard;
    document.getElementById('btn-extr').textContent = t.extr;
    document.getElementById('win-text').textContent = t.win;
    document.getElementById('play-again').textContent = t.again;
    document.getElementById('exit-win').textContent = t.exit;
    
    document.getElementById('st-header').textContent = t.st;
    document.getElementById('st-lang-label').textContent = t.lang;
    document.getElementById('close-settings').textContent = t.ok;
    document.getElementById('music-volume-label').textContent = t.musicVol;
    document.getElementById('effects-volume-label').textContent = t.effectsVol;
    
    soundToggle.textContent = musicEnabled ? t.sndOn : t.sndOff;
    timerToggle.textContent = timerEnabled ? t.timerOn : t.timerOff;
    
    document.getElementById('music-volume-value').textContent = Math.round(musicVolume * 100) + '%';
    document.getElementById('effects-volume-value').textContent = Math.round(effectsVolume * 100) + '%';
    
    document.getElementById('settings-btn').title = t.settingsBtn;
    document.getElementById('stats-btn').title = t.statsBtn;
    
    updateStatsDisplay();
  }

  function showMatchMessage() {
    const t = translations[currentLang] || translations.en;
    messageBox.textContent = t.match;
    messageBox.style.opacity = '1';
    setTimeout(() => { messageBox.style.opacity = '0'; }, 1200);
  }

  function setupBoard(cardsCount) {
    gameBoard.innerHTML = '';
    matchedPairs = 0;
    totalPairs = cardsCount / 2;
    gameStarted = false;
    const symbols = shuffle([...cardSymbols]).slice(0, totalPairs);
    const cardSet = shuffle([...symbols, ...symbols]);
    currentCols = Math.min(10, Math.ceil(Math.sqrt(cardSet.length)));
    gameBoard.style.gridTemplateColumns = `repeat(${currentCols}, 90px)`;
    
    cardSet.forEach((symbol, index) => {
      const card = document.createElement('div');
      card.className = 'card';
      const row = Math.floor(index / currentCols) + 1;
      const col = (index % currentCols) + 1;
      card.style.gridArea = `${row} / ${col} / ${row + 1} / ${col + 1}`;
      card.innerHTML = `<div class="card-inner"><div class="card-front">${symbol}</div><div class="card-back">‚ùì</div></div>`;
      card.dataset.symbol = symbol;
      card.onclick = () => onCardClick(card);
      gameBoard.appendChild(card);
    });
    lockBoard = false; 
    firstCard = null;
    
    if (timerEnabled) {
      resetTimer();
    }
  }

  function onCardClick(card) {
    if (lockBoard || card === firstCard || card.classList.contains('flipped') || card.classList.contains('disabled')) return;
    
    if (!gameStarted) {
      gameStarted = true;
      if (timerEnabled && !timerRunning) {
        startTimer();
      }
    }
    
    playEffect(soundFlip);
    card.classList.add('flipped');
    
    if (!firstCard) { 
      firstCard = card; 
      return; 
    }
    
    secondCard = card; 
    lockBoard = true;

    if (firstCard.dataset.symbol === secondCard.dataset.symbol) {
      playEffect(soundMatch);
      showMatchMessage();
      const c1 = firstCard; 
      const c2 = secondCard;
      
      document.querySelectorAll('.card').forEach(c => {
        c.classList.add('disabled');
      });
      
      setTimeout(() => {
        c1.style.transition = 'opacity 1s ease-in-out';
        c2.style.transition = 'opacity 1s ease-in-out';
        c1.style.opacity = '0';
        c2.style.opacity = '0';
        
        setTimeout(() => {
          c1.style.pointerEvents = 'none';
          c2.style.pointerEvents = 'none';
          
          document.querySelectorAll('.card:not([style*="opacity: 0"])').forEach(c => {
            c.classList.remove('disabled');
          });
          
          shuffleRemaining();
        }, 1000);
      }, 500);

      matchedPairs++;
      if (matchedPairs === totalPairs) {
        stopTimer();
        
        stats.totalGames++;
        stats.totalWins++;
        
        if (timerEnabled) {
          const gameTime = elapsedTime;
          stats.gameTimes.push(gameTime);
          
          if (gameTime < stats.bestTime) {
            stats.bestTime = gameTime;
          }
        }
        
        stats.lastWinTime = Date.now();
        saveStats();
        updateStatsDisplay();
        
        setTimeout(() => { 
          playEffect(soundWin); 
          modal.classList.add('active'); 
        }, 1500);
      }
      lockBoard = false; 
      firstCard = null;
    } else {
      playEffect(soundLose);
      setTimeout(() => {
        firstCard.classList.remove('flipped');
        secondCard.classList.remove('flipped');
        firstCard = null; 
        lockBoard = false;
      }, 1000);
    }
  }

  document.querySelectorAll('#difficulty button').forEach(btn => {
    btn.onclick = () => {
      playEffect(soundTap);
      setupBoard(parseInt(btn.dataset.cards));
      document.querySelectorAll('#difficulty button').forEach(b => b.disabled = false);
      btn.disabled = true;
      
      stats.totalGames++;
      saveStats();
      updateStatsDisplay();
    };
  });

  document.getElementById('settings-btn').onclick = () => { 
    playEffect(soundTap); 
    modalSt.classList.add('active'); 
    document.getElementById('music-volume').value = musicVolume * 100;
    document.getElementById('effects-volume').value = effectsVolume * 100;
  };
  
  document.getElementById('close-settings').onclick = () => { 
    playEffect(soundTap); 
    modalSt.classList.remove('active'); 
    saveSettings();
    saveStats();
  };
  
  statsBtn.onclick = () => {
    playEffect(soundTap);
    modalStats.classList.add('active');
  };
  
  document.getElementById('close-stats').onclick = () => {
    playEffect(soundTap);
    modalStats.classList.remove('active');
  };
  
  resetStatsBtn.onclick = () => {
    playEffect(soundTap);
    modalStats.classList.remove('active');
    modalConfirm.classList.add('active');
    playEffect(soundWarning);
  };
  
  confirmYesBtn.onclick = () => {
    playEffect(soundTap);
    stats = {
      bestTime: Infinity,
      totalWins: 0,
      totalGames: 0,
      totalPlayTime: 0,
      gameTimes: [],
      lastWinTime: null,
      sessionStartTime: Date.now()
    };
    saveStats();
    updateStatsDisplay();
    modalConfirm.classList.remove('active');
  };
  
  confirmNoBtn.onclick = () => {
    playEffect(soundTap);
    modalConfirm.classList.remove('active');
    modalStats.classList.add('active');
  };
  
  soundToggle.onclick = () => {
    musicEnabled = !musicEnabled;
    playEffect(soundTap);
    updateUI();
    toggleBgMusic();
    saveSettings();
  };

  timerToggle.onclick = toggleTimer;

  langSelect.addEventListener('change', (e) => {
    currentLang = e.target.value;
    updateUI();
    saveSettings();
  });

  document.getElementById('music-volume').addEventListener('input', (e) => {
    musicVolume = parseInt(e.target.value) / 100;
    updateVolumes();
    document.getElementById('music-volume-value').textContent = e.target.value + '%';
    saveSettings();
  });

  document.querySelector('.language-select-wrapper').addEventListener('click', () => {
    playEffect(soundTap);
  });

  document.getElementById('effects-volume').addEventListener('input', (e) => {
    effectsVolume = parseInt(e.target.value) / 100;
    updateVolumes();
    document.getElementById('effects-volume-value').textContent = e.target.value + '%';
    saveSettings();
  });

  document.getElementById('music-volume').addEventListener('mousedown', () => {
    playEffect(soundTap);
  });

  document.getElementById('effects-volume').addEventListener('mousedown', () => {
    playEffect(soundTap);
  });

  document.getElementById('play-again').onclick = () => {
    playEffect(soundTap);
    modal.classList.remove('active');
    const activeDifficulty = Array.from(document.querySelectorAll('#difficulty button')).find(b => b.disabled);
    setupBoard(activeDifficulty ? parseInt(activeDifficulty.dataset.cards) : 10);
  };

  document.getElementById('exit-win').onclick = () => {
    playEffect(soundTap);
    setTimeout(() => { window.close(); }, 150); 
  };

  window.addEventListener('beforeunload', () => {
    saveStats();
    saveSettings();
  });

  window.addEventListener('load', () => {
    loadSettings();
    loadStats();
    updateUI();
    updateVolumes();
    updateStatsInterval();
  });

  setupBoard(10);
</script>
</body>
</html>
